<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financial Tracker</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    html, body, #root { height: 100%; }
    .card { @apply rounded-2xl shadow p-6 bg-white; }
    .btn { @apply px-4 py-2 rounded-xl shadow text-white font-medium; }
    .btn-primary { @apply bg-indigo-600 hover:bg-indigo-700; }
    .btn-secondary { @apply bg-gray-800 hover:bg-black; }
    .btn-ghost { @apply bg-transparent text-indigo-600 hover:bg-indigo-50; }
    .input { @apply w-full border border-gray-300 rounded-xl px-3 py-2; }
    .label { @apply text-sm font-semibold text-gray-700; }
    .kpi { @apply card flex flex-col gap-2 items-start; }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root" class="min-h-full"></div>

  <script type="text/javascript">
    /********************
     * UTILITIES
     ********************/
    const { useState, useEffect, useMemo, useRef } = React;

    const fmt = new Intl.NumberFormat(undefined, { style: 'currency', currency: 'GBP' });

    const todayISO = () => new Date().toISOString().slice(0,10);

    function hashString(str) {
      const enc = new TextEncoder().encode(str);
      return crypto.subtle.digest('SHA-256', enc).then(buf =>
        Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('')
      );
    }

    function useLocalStorage(key, initialValue) {
      const [value, setValue] = useState(() => {
        try {
          const item = window.localStorage.getItem(key);
          return item ? JSON.parse(item) : initialValue;
        } catch (e) {
          return initialValue;
        }
      });
      useEffect(() => {
        try { window.localStorage.setItem(key, JSON.stringify(value)); } catch {}
      }, [key, value]);
      return [value, setValue];
    }

    function uid() { return Math.random().toString(36).slice(2) + Date.now().toString(36); }

    function sum(arr) { return arr.reduce((a,b)=>a+b,0); }

    function groupBy(arr, fn) {
      return arr.reduce((acc, x) => {
        const k = fn(x);
        (acc[k] ||= []).push(x);
        return acc;
      }, {});
    }

    function parseAmount(v) {
      const n = Number(v);
      return Number.isFinite(n) ? n : 0;
    }

    function weeksBetween(a, b) {
      const ms = (new Date(b) - new Date(a));
      return ms / (1000*60*60*24*7);
    }

    /********************
     * FAKE AUTH (localStorage)
     ********************/
    const LS_USERS = 'ft_users_v1';
    const LS_SESSION = 'ft_session_v1';

    function useAuth() {
      const [users, setUsers] = useLocalStorage(LS_USERS, []);
      const [session, setSession] = useLocalStorage(LS_SESSION, null);

      async function signup({ email, password }) {
        if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
          throw new Error('Email already registered');
        }
        const passwordHash = await hashString(password);
        const user = { id: uid(), email, passwordHash, createdAt: new Date().toISOString() };
        setUsers([...users, user]);
        setSession({ userId: user.id, email: user.email });
      }

      async function signin({ email, password }) {
        const u = users.find(u => u.email.toLowerCase() === email.toLowerCase());
        if (!u) throw new Error('User not found');
        const hash = await hashString(password);
        if (hash !== u.passwordHash) throw new Error('Invalid password');
        setSession({ userId: u.id, email: u.email });
      }

      function signout() { setSession(null); }

      return { users, session, signup, signin, signout };
    }

    /********************
     * DATA STORE (per-user, localStorage)
     ********************/
    function useStore(userId) {
      const [transactions, setTransactions] = useLocalStorage(`ft_tx_${userId}`, []);
      const [savings, setSavings] = useLocalStorage(`ft_sv_${userId}`, {
        emergency: { targetMonths: 3, monthlyExpenses: 0, balance: 0, history: [] },
        general: { name: 'General Savings', balance: 0, history: [] },
        investments: { name: 'Investments (manual)', balance: 0, history: [] }
      });
      const [subscriptions, setSubscriptions] = useLocalStorage(`ft_sub_${userId}`, []);

      return {
        transactions, setTransactions,
        savings, setSavings,
        subscriptions, setSubscriptions,
      };
    }

    /********************
     * CHART HOOK
     ********************/
    function useChart(canvasRef, config) {
      const chartRef = useRef(null);
      useEffect(() => {
        const ctx = canvasRef.current?.getContext('2d');
        if (!ctx) return;
        const chart = new Chart(ctx, config);
        chartRef.current = chart;
        return () => chart.destroy();
      }, [JSON.stringify(config)]);
    }

    /********************
     * ROUTING (hash)
     ********************/
    const Routes = {
      DASH: '#/dashboard',
      TX: '#/transactions',
      SUBS: '#/subscriptions',
      SAVE: '#/savings',
      CALC: '#/calculator',
      PROJ: '#/projections',
      SETTINGS: '#/settings',
      SIGNIN: '#/signin',
      SIGNUP: '#/signup',
    };

    function useHashRoute() {
      const [hash, setHash] = useState(window.location.hash || Routes.DASH);
      useEffect(() => {
        const onHash = () => setHash(window.location.hash || Routes.DASH);
        window.addEventListener('hashchange', onHash);
        return () => window.removeEventListener('hashchange', onHash);
      }, []);
      return [hash, (h)=>window.location.hash=h];
    }

    /********************
     * COMPONENTS
     ********************/
    function Layout({ session, onSignout, children }) {
      return (
        React.createElement('div', { className: 'mx-auto max-w-6xl p-4 md:p-8' },
          React.createElement('header', { className: 'flex items-center justify-between mb-6' },
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('div', { className: 'text-2xl font-bold' }, 'Financial Tracker'),
              React.createElement('span', { className: 'text-xs text-gray-500 hidden md:inline' }, '— local, private, deployable on Vercel')
            ),
            session ? React.createElement('div', { className: 'flex items-center gap-4' },
              React.createElement('span', { className: 'text-sm text-gray-600' }, session.email),
              React.createElement('button', { className:'btn btn-secondary', onClick:onSignout }, 'Sign out')
            ) : null
          ),
          children
        )
      );
    }

    function Nav() {
      const links = [
        { href: Routes.DASH, label:'Dashboard' },
        { href: Routes.TX, label:'Transactions' },
        { href: Routes.SUBS, label:'Subscriptions' },
        { href: Routes.SAVE, label:'Savings' },
        { href: Routes.CALC, label:'Emergency Calc' },
        { href: Routes.PROJ, label:'Projections' },
        { href: Routes.SETTINGS, label:'Settings' },
      ];
      return (
        React.createElement('nav', { className:'mb-6 grid grid-cols-2 sm:flex sm:flex-wrap gap-2' },
          links.map(l => React.createElement('a', {
            key:l.href, href:l.href,
            className:'card hover:shadow-md transition text-center font-medium'
          }, l.label))
        )
      );
    }

    function AuthPage({ mode='signin', onSignin, onSignup }) {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      async function submit(e){
        e.preventDefault(); setError('');
        try {
          if (mode==='signin') await onSignin({email, password});
          else await onSignup({email, password});
          window.location.hash = Routes.DASH;
        } catch (err) { setError(err.message || 'Error'); }
      }
      return (
        React.createElement('div', { className:'max-w-md mx-auto mt-20 card' },
          React.createElement('h1', { className:'text-2xl font-bold mb-2' }, mode==='signin'?'Sign in':'Create account'),
          React.createElement('p', { className:'text-sm text-gray-600 mb-4' }, 'Local-only auth using your browser storage.'),
          error && React.createElement('div', { className:'text-sm text-red-600 mb-2' }, error),
          React.createElement('form', { onSubmit:submit, className:'space-y-3' },
            React.createElement('div', null,
              React.createElement('label', { className:'label' }, 'Email'),
              React.createElement('input', { className:'input', value:email, onChange:e=>setEmail(e.target.value), required:true, type:'email', placeholder:'you@example.com' })
            ),
            React.createElement('div', null,
              React.createElement('label', { className:'label' }, 'Password'),
              React.createElement('input', { className:'input', value:password, onChange:e=>setPassword(e.target.value), required:true, type:'password', placeholder:'••••••••' })
            ),
            React.createElement('button', { className:'btn btn-primary w-full', type:'submit' }, mode==='signin'?'Sign in':'Sign up')
          ),
          React.createElement('div', { className:'mt-4 text-sm text-center' },
            mode==='signin' ?
              React.createElement('a', { className:'text-indigo-600', href:Routes.SIGNUP }, 'No account? Create one') :
              React.createElement('a', { className:'text-indigo-600', href:Routes.SIGNIN }, 'Have an account? Sign in')
          )
        )
      );
    }

    function Dashboard({ transactions, savings }) {
      const totalIncome = useMemo(() => sum(transactions.filter(t=>t.kind==='payment').map(t=>t.amount)), [transactions]);
      const totalExpense = useMemo(() => sum(transactions.filter(t=>t.kind!=='payment').map(t=>t.amount)), [transactions]);
      const net = totalIncome - totalExpense;

      const byCat = useMemo(()=>{
        const exp = transactions.filter(t=>t.kind!=='payment');
        const g = groupBy(exp, x=>x.category || 'Uncategorized');
        return Object.entries(g).map(([k,v])=>({
          label:k, value: sum(v.map(x=>x.amount))
        })).sort((a,b)=>b.value-a.value);
      }, [transactions]);

      const cash = (savings?.general?.balance || 0) + (savings?.emergency?.balance || 0) + (savings?.investments?.balance || 0);

      return (
        React.createElement('div', { className:'space-y-6' },
          React.createElement('div', { className:'grid md:grid-cols-4 gap-4' },
            React.createElement('div', { className:'kpi' },
              React.createElement('div', { className:'text-gray-500 text-sm' }, 'Income'),
              React.createElement('div', { className:'text-2xl font-bold' }, fmt.format(totalIncome))
            ),
            React.createElement('div', { className:'kpi' },
              React.createElement('div', { className:'text-gray-500 text-sm' }, 'Expenses'),
              React.createElement('div', { className:'text-2xl font-bold' }, fmt.format(totalExpense))
            ),
            React.createElement('div', { className:'kpi' },
              React.createElement('div', { className:'text-gray-500 text-sm' }, 'Net'),
              React.createElement('div', { className:'text-2xl font-bold' }, fmt.format(net))
            ),
            React.createElement('div', { className:'kpi' },
              React.createElement('div', { className:'text-gray-500 text-sm' }, 'Total Savings'),
              React.createElement('div', { className:'text-2xl font-bold' }, fmt.format(cash))
            )
          ),
          React.createElement('div', { className:'grid md:grid-cols-2 gap-4' },
            React.createElement(SpendByCategoryChart, { data: byCat }),
            React.createElement(CashflowChart, { transactions })
          )
        )
      );
    }

    function SpendByCategoryChart({ data }) {
      const canvasRef = useRef(null);
      useChart(canvasRef, {
        type: 'doughnut',
        data: {
          labels: data.map(d=>d.label),
          datasets: [{
            data: data.map(d=>d.value)
          }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
      });
      return React.createElement('div', { className:'card' },
        React.createElement('h3', { className:'font-semibold mb-3' }, 'Spending by Category (YTD)'),
        React.createElement('canvas', { ref: canvasRef, height: 200 })
      );
    }

    function CashflowChart({ transactions }) {
      const canvasRef = useRef(null);
      const points = useMemo(()=>{
        const g = groupBy(transactions, t=>t.date.slice(0,7)); // YYYY-MM
        const months = Object.keys(g).sort();
        return months.map(m => {
          const inc = sum(g[m].filter(t=>t.kind==='payment').map(t=>t.amount));
          const out = sum(g[m].filter(t=>t.kind!=='payment').map(t=>t.amount));
          return { m, net: inc - out };
        });
      }, [transactions]);
      useChart(canvasRef, {
        type: 'line',
        data: { labels: points.map(p=>p.m), datasets: [{ label:'Net', data: points.map(p=>p.net) }] },
        options: { scales: { y: { beginAtZero: true } } }
      });
      return React.createElement('div', { className:'card' },
        React.createElement('h3', { className:'font-semibold mb-3' }, 'Monthly Net Cashflow'),
        React.createElement('canvas', { ref: canvasRef, height: 200 })
      );
    }

    function TransactionsPage({ transactions, setTransactions }) {
      const [form, setForm] = useState({ kind:'expense', amount:'', date: todayISO(), category:'', note:'' });

      function addTx(e){
        e.preventDefault();
        const tx = { id: uid(), ...form, amount: parseAmount(form.amount) };
        setTransactions([tx, ...transactions]);
        setForm({ kind:'expense', amount:'', date: todayISO(), category:'', note:'' });
      }
      function remove(id){ setTransactions(transactions.filter(t=>t.id!==id)); }

      return (
        React.createElement('div', { className:'grid md:grid-cols-2 gap-4' },
          React.createElement('div', { className:'card' },
            React.createElement('h3', { className:'font-semibold mb-2' }, 'Add Transaction'),
            React.createElement('form', { className:'grid grid-cols-2 gap-3', onSubmit:addTx },
              React.createElement('div', { className:'col-span-2' },
                React.createElement('label', { className:'label' }, 'Type'),
                React.createElement('select', { className:'input', value:form.kind, onChange:e=>setForm({...form, kind:e.target.value}) },
                  React.createElement('option', { value:'expense' }, 'Expense'),
                  React.createElement('option', { value:'subscription' }, 'Subscription'),
                  React.createElement('option', { value:'payment' }, 'Income / Payment')
                )
              ),
              React.createElement('div', null,
                React.createElement('label', { className:'label' }, 'Amount (£)'),
                React.createElement('input', { className:'input', value:form.amount, onChange:e=>setForm({...form, amount:e.target.value}), type:'number', step:'0.01', required:true })
              ),
              React.createElement('div', null,
                React.createElement('label', { className:'label' }, 'Date'),
                React.createElement('input', { className:'input', value:form.date, onChange:e=>setForm({...form, date:e.target.value}), type:'date', required:true })
              ),
              React.createElement('div', { className:'col-span-2' },
                React.createElement('label', { className:'label' }, 'Category'),
                React.createElement('input', { className:'input', value:form.category, onChange:e=>setForm({...form, category:e.target.value}), placeholder:'Groceries, Rent, Salary...' })
              ),
              React.createElement('div', { className:'col-span-2' },
                React.createElement('label', { className:'label' }, 'Note'),
                React.createElement('input', { className:'input', value:form.note, onChange:e=>setForm({...form, note:e.target.value}), placeholder:'Optional' })
              ),
              React.createElement('button', { className:'btn btn-primary col-span-2', type:'submit' }, 'Add')
            )
          ),
          React.createElement('div', { className:'card overflow-x-auto' },
            React.createElement('h3', { className:'font-semibold mb-2' }, 'Transactions'),
            React.createElement('table', { className:'w-full text-sm' },
              React.createElement('thead', { className:'text-left text-gray-600' },
                React.createElement('tr', null,
                  React.createElement('th', { className:'py-2 pr-2' }, 'Date'),
                  React.createElement('th', { className:'py-2 pr-2' }, 'Type'),
                  React.createElement('th', { className:'py-2 pr-2' }, 'Category'),
                  React.createElement('th', { className:'py-2 pr-2' }, 'Amount'),
                  React.createElement('th', { className:'py-2 pr-2' }),
                )
              ),
              React.createElement('tbody', null,
                transactions.map(t => React.createElement('tr', { key:t.id, className:'border-t' },
                  React.createElement('td', { className:'py-2 pr-2' }, t.date),
                  React.createElement('td', { className:'py-2 pr-2 capitalize' }, t.kind),
                  React.createElement('td', { className:'py-2 pr-2' }, t.category || '—'),
                  React.createElement('td', { className:'py-2 pr-2' }, fmt.format(t.amount)),
                  React.createElement('td', { className:'py-2 pr-2 text-right' },
                    React.createElement('button', { className:'btn btn-ghost', onClick:()=>remove(t.id) }, 'Delete')
                  )
                ))
              )
            )
          )
        )
      );
    }

    function SubscriptionsPage({ subscriptions, setSubscriptions }) {
      const [form, setForm] = useState({ name:'', amount:'', cadence:'monthly', start: todayISO() });

      function addSub(e){
        e.preventDefault();
        const s = { id: uid(), ...form, amount: parseAmount(form.amount) };
        setSubscriptions([s, ...subscriptions]);
        setForm({ name:'', amount:'', cadence:'monthly', start: todayISO() });
      }
      function remove(id){ setSubscriptions(subscriptions.filter(s=>s.id!==id)); }

      return (
        React.createElement('div', { className:'grid md:grid-cols-2 gap-4' },
          React.createElement('div', { className:'card' },
            React.createElement('h3', { className:'font-semibold mb-2' }, 'Add Subscription'),
            React.createElement('form', { className:'grid grid-cols-2 gap-3', onSubmit:addSub },
              React.createElement('div', { className:'col-span-2' },
                React.createElement('label', { className:'label' }, 'Name'),
                React.createElement('input', { className:'input', value:form.name, onChange:e=>setForm({...form, name:e.target.value}), required:true, placeholder:'Netflix, Gym...' })
              ),
              React.createElement('div', null,
                React.createElement('label', { className:'label' }, 'Amount (£)'),
                React.createElement('input', { className:'input', value:form.amount, onChange:e=>setForm({...form, amount:e.target.value}), type:'number', step:'0.01', required:true })
              ),
              React.createElement('div', null,
                React.createElement('label', { className:'label' }, 'Cadence'),
                React.createElement('select', { className:'input', value:form.cadence, onChange:e=>setForm({...form, cadence:e.target.value}) },
                  React.createElement('option', { value:'monthly' }, 'Monthly'),
                  React.createElement('option', { value:'weekly' }, 'Weekly'),
                  React.createElement('option', { value:'yearly' }, 'Yearly')
                )
              ),
              React.createElement('div', { className:'col-span-2' },
                React.createElement('label', { className:'label' }, 'Start date'),
                React.createElement('input', { className:'input', value:form.start, onChange:e=>setForm({...form, start:e.target.value}), type:'date', required:true })
              ),
              React.createElement('button', { className:'btn btn-primary col-span-2', type:'submit' }, 'Add')
            )
          ),
          React.createElement('div', { className:'card overflow-x-auto' },
            React.createElement('h3', { className:'font-semibold mb-2' }, 'Subscriptions'),
            React.createElement('table', { className:'w-full text-sm' },
              React.createElement('thead', { className:'text-left text-gray-600' },
                React.createElement('tr', null,
                  React.createElement('th', { className:'py-2 pr-2' }, 'Name'),
                  React.createElement('th', { className:'py-2 pr-2' }, 'Cadence'),
                  React.createElement('th', { className:'py-2 pr-2' }, 'Amount'),
                  React.createElement('th', { className:'py-2 pr-2' }, 'Start'),
                  React.createElement('th', { className:'py-2 pr-2' }),
                )
              ),
              React.createElement('tbody', null,
                subscriptions.map(s => React.createElement('tr', { key:s.id, className:'border-t' },
                  React.createElement('td', { className:'py-2 pr-2' }, s.name),
                  React.createElement('td', { className:'py-2 pr-2 capitalize' }, s.cadence),
                  React.createElement('td', { className:'py-2 pr-2' }, fmt.format(s.amount)),
                  React.createElement('td', { className:'py-2 pr-2' }, s.start),
                  React.createElement('td', { className:'py-2 pr-2 text-right' },
                    React.createElement('button', { className:'btn btn-ghost', onClick:()=>remove(s.id) }, 'Delete')
                  )
                ))
              )
            )
          )
        )
      );
    }

    function SavingsPage({ savings, setSavings }) {
      const [tab, setTab] = useState('emergency');
      const acct = savings[tab];
      const [amount, setAmount] = useState('');

      function deposit(e){
        e.preventDefault(); const a = parseAmount(amount); if (!a) return;
        const now = new Date().toISOString();
        const updated = { ...savings };
        updated[tab] = {
          ...acct,
          balance: (acct.balance||0) + a,
          history: [{ date: now, amount: a }, ...(acct.history||[])]
        };
        setSavings(updated); setAmount('');
      }

      return (
        React.createElement('div', { className:'card' },
          React.createElement('div', { className:'flex gap-2 mb-4' },
            ['emergency','general','investments'].map(k =>
              React.createElement('button', { key:k, className: `btn ${tab===k?'btn-primary':'btn-ghost'}`, onClick:()=>setTab(k) }, k)
            )
          ),
          tab==='emergency' && React.createElement('div', { className:'mb-4 grid md:grid-cols-3 gap-3' },
            React.createElement('div', null,
              React.createElement('label', { className:'label' }, 'Target months'),
              React.createElement('input', { className:'input', type:'number', min:'0', value:acct.targetMonths, onChange:e=>setSavings({ ...savings, emergency: { ...acct, targetMonths: Number(e.target.value) } }) })
            ),
            React.createElement('div', null,
              React.createElement('label', { className:'label' }, 'Monthly expenses (£)'),
              React.createElement('input', { className:'input', type:'number', min:'0', value:acct.monthlyExpenses, onChange:e=>setSavings({ ...savings, emergency: { ...acct, monthlyExpenses: Number(e.target.value) } }) })
            ),
            React.createElement('div', { className:'flex items-end' },
              React.createElement('div', { className:'text-sm text-gray-600' },
                'Target fund: ', React.createElement('span', { className:'font-semibold' }, fmt.format((acct.targetMonths||0)*(acct.monthlyExpenses||0)))
              )
            )
          ),
          React.createElement('div', { className:'mb-4' },
            React.createElement('div', { className:'text-sm text-gray-600' }, 'Balance'),
            React.createElement('div', { className:'text-2xl font-bold' }, fmt.format(acct.balance||0))
          ),
          React.createElement('form', { className:'grid grid-cols-1 md:grid-cols-3 gap-3', onSubmit:deposit },
            React.createElement('div', { className:'md:col-span-2' },
              React.createElement('label', { className:'label' }, 'Add money (£)'),
              React.createElement('input', { className:'input', type:'number', step:'0.01', value:amount, onChange:e=>setAmount(e.target.value), placeholder:'e.g. 100' })
            ),
            React.createElement('div', { className:'flex items-end' },
              React.createElement('button', { className:'btn btn-primary w-full', type:'submit' }, 'Add')
            )
          ),
          React.createElement('div', { className:'mt-4' },
            React.createElement('h4', { className:'font-semibold mb-2' }, 'Recent contributions'),
            (acct.history||[]).length===0 ? React.createElement('div', { className:'text-sm text-gray-600' }, 'No contributions yet') :
            React.createElement('ul', { className:'space-y-2' },
              (acct.history||[]).map((h,i)=> React.createElement('li', { key:i, className:'flex justify-between text-sm border-b pb-1' },
                React.createElement('span', null, new Date(h.date).toLocaleString()),
                React.createElement('span', { className:'font-medium' }, fmt.format(h.amount))
              ))
            )
          )
        )
      );
    }

    function EmergencyCalculatorPage({ transactions }) {
      const [months, setMonths] = useState(3);
      const avgMonthly = useMemo(() => {
        const exp = transactions.filter(t=>t.kind!=='payment');
        const byMonth = groupBy(exp, t=>t.date.slice(0,7));
        const vals = Object.values(byMonth).map(list => sum(list.map(x=>x.amount)));
        const avg = vals.length ? sum(vals)/vals.length : 0;
        return avg;
      }, [transactions]);
      const target = months * avgMonthly;
      return (
        React.createElement('div', { className:'card' },
          React.createElement('h3', { className:'font-semibold mb-2' }, 'Emergency Fund Calculator'),
          React.createElement('p', { className:'text-sm text-gray-600 mb-4' }, 'We estimate your average monthly expenses from your transactions.'),
          React.createElement('div', { className:'grid md:grid-cols-3 gap-3' },
            React.createElement('div', null,
              React.createElement('label', { className:'label' }, 'Average monthly spend'),
              React.createElement('div', { className:'text-xl font-bold' }, fmt.format(avgMonthly))
            ),
            React.createElement('div', null,
              React.createElement('label', { className:'label' }, 'Months of cover'),
              React.createElement('input', { className:'input', type:'number', min:'0', value:months, onChange:e=>setMonths(Number(e.target.value)) })
            ),
            React.createElement('div', null,
              React.createElement('label', { className:'label' }, 'Target fund'),
              React.createElement('div', { className:'text-xl font-bold' }, fmt.format(target))
            )
          )
        )
      );
    }

    function ProjectionsPage({ savings }) {
      // Use general savings history as contributions
      const history = savings.general.history || [];
      const [weeks, setWeeks] = useState(26);
      const startBalance = savings.general.balance || 0;

      const weeklyAvg = useMemo(() => {
        if (history.length < 1) return 0;
        const sorted = [...history].sort((a,b)=> new Date(a.date)-new Date(b.date));
        const first = sorted[0].date, last = sorted[sorted.length-1].date;
        const spanWeeks = Math.max(weeksBetween(first,last), 1/7);
        const total = sum(sorted.map(h=>h.amount));
        return total / spanWeeks; // £ per week
      }, [history]);

      const points = useMemo(() => {
        const pts = [];
        let bal = startBalance;
        for (let i=0;i<=weeks;i++) {
          if (i>0) bal += weeklyAvg; // add average weekly contribution
          pts.push({ label: `W${i}`, value: bal });
        }
        return pts;
      }, [weeks, weeklyAvg, startBalance]);

      const canvasRef = useRef(null);
      useChart(canvasRef, {
        type:'line',
        data:{ labels: points.map(p=>p.label), datasets:[{ label:'Projected Balance', data: points.map(p=>p.value) }] },
        options:{ scales:{ y:{ beginAtZero:true } } }
      });

      return (
        React.createElement('div', { className:'grid md:grid-cols-2 gap-4' },
          React.createElement('div', { className:'card' },
            React.createElement('h3', { className:'font-semibold mb-2' }, 'Predictive Savings Projection'),
            React.createElement('p', { className:'text-sm text-gray-600 mb-2' }, 'Uses your average weekly contribution (based on history) to project forward.'),
            React.createElement('div', { className:'mb-3' },
              React.createElement('label', { className:'label' }, 'Weeks ahead'),
              React.createElement('input', { className:'input', type:'number', min:'1', value:weeks, onChange:e=>setWeeks(Number(e.target.value)) })
            ),
            React.createElement('div', { className:'text-sm text-gray-600' }, 'Current average weekly contribution: ', React.createElement('span', { className:'font-semibold' }, fmt.format(weeklyAvg)))
          ),
          React.createElement('div', { className:'card' },
            React.createElement('canvas', { ref:canvasRef, height:240 })
          )
        )
      );
    }

    function SettingsPage({ session, store }) {
      function exportAll(){
        const blob = new Blob([JSON.stringify(store, null, 2)], { type:'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `financial-tracker-${session.email}.json`; a.click();
        URL.revokeObjectURL(url);
      }
      function importAll(e){
        const file = e.target.files?.[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const data = JSON.parse(reader.result);
            if (!data) throw new Error('Invalid file');
            // naive merge
            if (data.transactions) store.setTransactions(data.transactions);
            if (data.savings) store.setSavings(data.savings);
            if (data.subscriptions) store.setSubscriptions(data.subscriptions);
            alert('Imported!');
          } catch(err){ alert('Import failed: '+ err.message); }
        };
        reader.readAsText(file);
      }
      return (
        React.createElement('div', { className:'card space-y-4' },
          React.createElement('h3', { className:'font-semibold' }, 'Backup & Restore'),
          React.createElement('div', { className:'flex gap-2 items-center' },
            React.createElement('button', { className:'btn btn-primary', onClick:exportAll }, 'Export JSON'),
            React.createElement('label', { className:'btn btn-secondary cursor-pointer' },
              'Import JSON',
              React.createElement('input', { type:'file', accept:'application/json', className:'hidden', onChange:importAll })
            ),
            React.createElement('span', { className:'text-sm text-gray-600' }, 'Data is stored locally in your browser (per account).')
          ),
          React.createElement('div', { className:'pt-2 border-t' },
            React.createElement('h4', { className:'font-semibold mb-1' }, 'Tips & Suggestions'),
            React.createElement('ul', { className:'list-disc pl-6 text-sm text-gray-700 space-y-1' },
              React.createElement('li', null, 'Use Subscriptions to list recurring costs—then add matching Transactions monthly.'),
              React.createElement('li', null, 'Keep categories consistent (e.g., "Groceries", "Rent", "Transport") for better charts.'),
              React.createElement('li', null, 'Add savings contributions under the Savings tab; projections use that history.'),
              React.createElement('li', null, 'Back up your data regularly with Export JSON (you can Import later).')
            )
          )
        )
      );
    }

    /********************
     * APP
     ********************/
    function App() {
      const auth = useAuth();
      const [hash, setHash] = useHashRoute();

      if (!auth.session) {
        if (hash===Routes.SIGNUP) return React.createElement(Layout, null, React.createElement(AuthPage, { mode:'signup', onSignup:auth.signup }));
        return React.createElement(Layout, null, React.createElement(AuthPage, { mode:'signin', onSignin:auth.signin }));
      }

      const store = useStore(auth.session.userId);

      let content = null;
      if (hash===Routes.DASH) content = React.createElement(Dashboard, { transactions: store.transactions, savings: store.savings });
      else if (hash===Routes.TX) content = React.createElement(TransactionsPage, { transactions: store.transactions, setTransactions: store.setTransactions });
      else if (hash===Routes.SUBS) content = React.createElement(SubscriptionsPage, { subscriptions: store.subscriptions, setSubscriptions: store.setSubscriptions });
      else if (hash===Routes.SAVE) content = React.createElement(SavingsPage, { savings: store.savings, setSavings: store.setSavings });
      else if (hash===Routes.CALC) content = React.createElement(EmergencyCalculatorPage, { transactions: store.transactions });
      else if (hash===Routes.PROJ) content = React.createElement(ProjectionsPage, { savings: store.savings });
      else if (hash===Routes.SETTINGS) content = React.createElement(SettingsPage, { session: auth.session, store });
      else if (hash===Routes.SIGNIN) content = React.createElement(AuthPage, { mode:'signin', onSignin:auth.signin });
      else if (hash===Routes.SIGNUP) content = React.createElement(AuthPage, { mode:'signup', onSignup:auth.signup });
      else content = React.createElement('div', null, 'Not found');

      return (
        React.createElement(Layout, { session: auth.session, onSignout: auth.signout },
          React.createElement(Nav, null),
          content,
          React.createElement('footer', { className:'text-center text-xs text-gray-500 mt-12 pb-8' },
            'Local-only demo • No servers • Made for quick Vercel deploy'
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
